{% extends "layout.html" %}

{% block title %}
Routine
{% endblock %}

{% block body %}

<div class="top">
    <a href="/edit">Edit</a>
    <a href="">Project: Routine</a>
    <a href="/statistics">Statistics</a>
</div>
<div class="middle">

    <div id="clock">
        <h2 id="clock-top"></h2>
        <h3 id="clock-bottom"></h3>
    </div>
    <form action="/study" method="post">
        <select name="task" id="task-select">
            <option disabled selected value="">Task</option>
            {% for task in tasks %}
              <option
                data-rest-time="{{ task.rest_time }}"
                data-repetition="{{ task.repetition }}"
                data-work-time="{{ task.work_time }}"
                value="{{ task.name }}"
              >
                {{ task.name }}
              </option>
            {% endfor %}
        </select>
        <br>

        Work Time: <input id="work-time" name="work-time" type="number" min="1" max="60"> minutes
        <br>
        Repetition: <input id="repetition" name="repetition" type="number" min="1">
        <br>
        Rest Time: <input id="rest-time" name="rest-time" type="number" min="1" max="30"> minutes

        <br>
        <button>Start</button>
    </form>
</div>
<script>
    const updateDateTime = () => {
        const clockTopElement = document.getElementById('clock-top');
        const clockBottomElement = document.getElementById('clock-bottom');
        const currentTime = new Date();

        const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const dayOfWeek = daysOfWeek[currentTime.getDay()];

        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const month = months[currentTime.getMonth()];

        const day = currentTime.getDate();

        let hours = currentTime.getHours();
        const ampm = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12 || 12;

        const minutes = currentTime.getMinutes().toString().padStart(2, '0');
        const seconds = currentTime.getSeconds().toString().padStart(2, '0');

        const topString = `${hours}:${minutes}:${seconds} ${ampm}`;
        const bottomString = `${dayOfWeek}, ${month} ${day}`;
        clockTopElement.textContent = topString;
        clockBottomElement.textContent = bottomString;
    }

    const updateFormInput = () => {
      document.getElementById('task-select').addEventListener('change', function() {
        const selected = this.options[this.selectedIndex];

        document.getElementById('work-time').value = selected.dataset.workTime || '';
        document.getElementById('repetition').value = selected.dataset.repetition || '';
        document.getElementById('rest-time').value = selected.dataset.restTime || '';
      });
    }

    setInterval(updateDateTime, 1000);
    updateDateTime();
    updateFormInput();

</script>

{% endblock %}
